<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<!-- Galleri-knapp -->
<button type="button" class="btn btn-secondary mb-2" id="openGalleryBtn">
    Välj bild från galleri
</button>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
            const textarea = document.querySelector('#contentArea');
            if (!textarea || typeof toastui === "undefined") return;

            const editorContainer = document.createElement('div');
            editorContainer.id = "toastEditor";
            editorContainer.style.height = "400px";
            textarea.style.display = "none";
            textarea.parentNode.insertBefore(editorContainer, textarea);

            const editor = new toastui.Editor({
                el: editorContainer,
                height: '400px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                initialValue: textarea.value || ""
            });

            window.activeEditor = {
                insertText: (text) => editor.insertText(text),
                setHTML: (html) => editor.setHTML(html),
                getHTML: () => editor.getHTML()
            };

            const form = textarea.closest("form");
            if (form) {
                form.addEventListener("submit", () => {
                    textarea.value = editor.getHTML();
                });
            }

        }, 100); // fördröj editor-init med 100ms
    });
</script>
